<!DOCTYPE html>
<html lang="zh-tw">

<head>
	<meta charset="UTF-8">
	<title>情緒抒發</title>
	<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', async (event) => {
			await liff.init({ liffId: "2004371786-VM8L0OQr" });
			if (!liff.isLoggedIn()) {
				liff.login();
			}
			const profile = await liff.getProfile();
			const userId = profile.userId;

			/*情緒分數*/
			const feelings = document.getElementById('feelings');
			var feelingsValue = feelings.value;
			feelings.addEventListener('input', function () {
				const value = feelings.value;
				feelingsValue = value;
				if (value === '1')
					document.querySelector('.feeling').textContent = '非常不好';
				else if (value === '2')
					document.querySelector('.feeling').textContent = '不好';
				else if (value === '3')
					document.querySelector('.feeling').textContent = '普通';
				else if (value === '4')
					document.querySelector('.feeling').textContent = '好';
				else if (value === '5')
					document.querySelector('.feeling').textContent = '非常好';
			});

			/*情緒關鍵詞*/
			const selectedFeelings = [];
			// 為每個情緒按鈕添加事件監聽器
			document.querySelectorAll('input[type="button"]').forEach(button => {
				button.addEventListener('click', () => {
					const feeling = button.value;
					if (!selectedFeelings.includes(feeling)) {
						selectedFeelings.push(feeling);
						button.style.backgroundColor = 'lightblue'; // 標記為已選擇
					} else {
						const index = selectedFeelings.indexOf(feeling);
						selectedFeelings.splice(index, 1);
						button.style.backgroundColor = ''; // 取消標記
					}
				});
			});

			/*表單提交*/
			document.getElementById('dataForm').addEventListener('submit', function (e) {
				// 防止表單的預設提交行為
				e.preventDefault();
				const formData = {
					Time: new Date().toLocaleString(),
					LineID: userId,
					MoodVaule: feelingsValue,
					MoodKeyWord: selectedFeelings,
					MoodWord: document.getElementById('mood').value,
				};

				fetch('https://6c0c-2402-7500-5ce-2b57-486b-c92-bb-c83f.ngrok-free.app', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify(formData),
				})
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.json();
					})
					.then(data => {
						console.log(data);
						location.reload();
					})
					.catch(error => {
						console.error('There has been a problem with your fetch operation:', error);
					});
			});
		});
	</script>
</head>

<body>
	<form id="dataForm">
		<div>
			<p>你現在感受如何呢?</p>
			<p class="feeling">普通</p>
			<input type="range" id="feelings" name="feelings" min="1" max="5" value="3">
		</div>
		<div>
			<p>請選擇你覺得與你狀態相符的關鍵詞</p>
			<input type="button" id="emptiness" name="emptiness" value="空虛">
			<input type="button" id="heartache" name="heartache" value="心痛">
			<input type="button" id="frustrated" name="frustrated" value="沮喪">
			<input type="button" id="happy" name="happy" value="快樂"><br>
			<input type="button" id="disturbed" name="disturbed" value="不安">
			<input type="button" id="panic" name="panic" value="慌張">
			<input type="button" id="frightened" name="frightened" value="驚恐">
			<input type="button" id="angry" name="angry" value="生氣"><br>
			<input type="button" id="restless" name="restless" value="焦躁">
			<input type="button" id="bored" name="bored" value="厭煩">
			<input type="button" id="anguish" name="anguish" value="煩悶">
			<input type="button" id="excited" name="excited" value="興奮"><br>
		</div>
		<div>
			<p>請試著寫下你現在的情緒與想法</p>
			<input type="text" id="mood" name="mood" style="height:100px; width:300px">
		</div>
		<button type="submit">提交</button>
	</form>

</body>

</html>
